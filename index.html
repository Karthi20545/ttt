<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANNAMALAIYAR FINANCE рлР ЁУЙ╕ЁУЖШ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
            webkit-text-size-adjust: 100%;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px; /* Larger font for mobile */
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 15px; /* Larger padding for mobile */
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            -webkit-appearance: none; /* Remove iOS styling */
        }
        button.delete-btn {
            background: #e74c3c;
        }
        button.print-btn {
            background: #2ecc71;
        }
        button:hover {
            opacity: 0.9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: top;
        }
        th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .total-summary {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .message {
            font-size: 14px;
            margin-top: 5px;
            padding: 5px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 800px;
            max-height: 80vh;
            overflow: auto;
            width: 90%;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .nowrap {
            white-space: nowrap;
        }
        .balance {
            color: #e74c3c;
            font-weight: bold;
        }
        .customer-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #3498db;
        }
        .customer-image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #3498db;
            margin: 10px 0;
            display: none;
        }
        .signature-preview {
            width: 150px;
            height: 50px;
            border: 1px solid #ddd;
            margin: 10px 0;
            display: none;
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .section {
                padding: 15px;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 8px;
            }
            .action-buttons {
                flex-direction: column;
                gap: 3px;
            }
            button {
                padding: 10px 12px; /* Slightly larger for mobile */
                font-size: 14px;
                margin-right: 5px;
                width: 100%; /* Full width buttons on mobile */
                margin-bottom: 5px;
            }
            .customer-image {
                width: 40px;
                height: 40px;
            }
            input, select {
                padding: 8px;
                font-size: 14px; /* Slightly larger font for mobile */
            }
            .form-group {
                margin-bottom: 12px;
            }
        }
        
        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #printSection, #printSection * {
                visibility: visible;
            }
            #printSection {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background: white;
                margin: 0;
            }
            .no-print {
                display: none !important;
            }
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 8px;
            }
            th {
                background-color: #3498db !important;
                color: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            @page {
                size: A4;
                margin: 10mm;
            }
            .page-number:after {
                content: counter(page);
            }
            .print-footer {
                position: fixed;
                bottom: 0;
                width: 100%;
                text-align: center;
                font-size: 10px;
                padding: 10px;
            }
            .print-image {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                object-fit: cover;
                border: 2px solid #3498db;
            }
            .print-signature {
                width: 150px;
                height: 60px;
                margin-top: 10px;
                border: 1px solid #000;
            }
            .signature-line {
                border-top: 1px solid #000;
                width: 150px;
                margin-top: 40px;
            }
            .signature-container {
                margin-top: 40px;
                display: flex;
                justify-content: space-between;
            }
            .signature-box {
                text-align: center;
                width: 45%;
            }
            .signature-title {
                margin-top: 5px;
                font-weight: bold;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ANNAMALAIYAR FINANCE рлР ЁУЙ╕ЁУЖШ</h1>
        
        <div class="section">
            <h2>рокрпБродро┐роп ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роЪрпЗро░рпНроХрпНроХ</h2>
            <form id="customerForm">
                <div class="form-group">
                    <label for="customerName">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="phoneNumber">родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН</label>
                    <input type="text" id="phoneNumber" pattern="[0-9]{10}" title="10 digit phone number" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label for="aadharNumber">роЖродро╛ро░рпН роОрогрпН</label>
                    <input type="text" id="aadharNumber" pattern="[0-9]{12}" title="12 digit Aadhar number" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label for="principalAmount">роЕроЪро▓рпН родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="principalAmount" required min="1" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label for="interestRate">ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН (%)</label>
                    <input type="number" id="interestRate" value="3" required min="0" max="100" step="0.01" inputmode="decimal">
                </div>
                <div class="form-group">
                    <label for="startDate">родрпКроЯроХрпНроХ родрпЗродро┐</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="form-group">
                    <label for="customerImage">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокроЯроорпН</label>
                    <input type="file" id="customerImage" accept="image/*" capture="camera">
                    <img id="customerImagePreview" class="customer-image-preview" alt="Customer Image Preview">
                </div>
                <div class="form-group">
                    <label for="customerSignature">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роХрпИропрпКрокрпНрокроорпН</label>
                    <input type="file" id="customerSignature" accept="image/*" capture="camera">
                    <img id="customerSignaturePreview" class="signature-preview" alt="Customer Signature Preview">
                </div>
                <div class="form-group">
                    <label for="ownerSignature">роЙро░ро┐роорпИропро╛ро│ро░рпН роХрпИропрпКрокрпНрокроорпН</label>
                    <input type="file" id="ownerSignature" accept="image/*" capture="camera">
                    <img id="ownerSignaturePreview" class="signature-preview" alt="Owner Signature Preview">
                </div>
                <button type="submit" id="addCustomerBtn">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роЪрпЗро░рпНроХрпНроХ</button>
                <div id="formMessage" class="message" style="display:none;"></div>
            </form>
        </div>
        
        <!-- Rest of your HTML remains the same -->
        <div class="section">
            <h2>ро╡роЯрпНроЯро┐ рокрогроорпН рокрпЖро▒рпБродро▓рпН</h2>
            <form id="paymentForm">
                <div class="form-group">
                    <label for="customerSelect">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</label>
                    <select id="customerSelect" required>
                        <option value="">-- ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentDate">рокрогроорпН рокрпЖро▒рпБроорпН родрпЗродро┐</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <div class="form-group">
                    <label for="dueAmount">ро╡роЯрпНроЯро┐ родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="dueAmount" readonly>
                </div>
                <div class="form-group">
                    <label for="paidAmount">рокрпЖро▒рокрпНрокроЯрпНроЯ родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="paidAmount" required min="1" inputmode="decimal">
                </div>
                <div class="form-group">
                    <label for="balanceAmount">роорпАродро┐ родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="balanceAmount" readonly>
                </div>
                <div class="form-group">
                    <label for="paymentNotes">роХрпБро▒ро┐рокрпНрокрпБроХро│рпН</label>
                    <input type="text" id="paymentNotes">
                </div>
                <button type="submit" id="addPaymentBtn">рокрогродрпНродрпИ рокродро┐ро╡рпБ роЪрпЖропрпНроХ</button>
                <div id="paymentMessage" class="message" style="display:none;"></div>
            </form>
        </div>
        
        <div class="section">
            <h2>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокродро┐ро╡рпБроХро│рпН</h2>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН, родрпКро▓рпИрокрпЗроЪро┐ роЕро▓рпНро▓родрпБ роЖродро╛ро░рпН роОрогрпН роорпВро▓роорпН родрпЗроЯрпБ..." style="width: 100%; max-width: 300px; padding: 10px;">
                <button onclick="searchCustomers()">родрпЗроЯрпБ</button>
                <button onclick="resetSearch()">роорпАроЯрпНроЯроорпИ</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table id="customerTable">
                    <thead>
                        <tr>
                            <th>рокроЯроорпН</th>
                            <th>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН</th>
                            <th>родрпКро▓рпИрокрпЗроЪро┐</th>
                            <th>роЖродро╛ро░рпН роОрогрпН</th>
                            <th>роЕроЪро▓рпН</th>
                            <th>ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН</th>
                            <th>рооро╛родро╛роирпНродро┐ро░ ро╡роЯрпНроЯро┐</th>
                            <th>родрпКроЯроХрпНроХроорпН</th>
                            <th>роорпКродрпНродроорпН роЪрпЖро▓рпБродрпНродро┐ропродрпБ</th>
                            <th>роорпАродро┐ родрпКроХрпИ</th>
                            <th>роХроЯрпИроЪро┐ рокрогроорпН</th>
                            <th>роЪрпЖропро▓рпНроХро│рпН</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="total-summary">
                <h3>ро╡рогро┐роХ роЪрпБро░рпБроХрпНроХроорпН</h3>
                <p>роорпКродрпНрод ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпНроХро│рпН: <span id="totalCustomers">0</span></p>
                <p>роорпКродрпНрод роЕроЪро▓рпН родрпКроХрпИ: тВ╣<span id="totalPrincipal">0</span></p>
                <p>роорпКродрпНрод ро╡роЯрпНроЯро┐ родрпКроХрпИ: тВ╣<span id="totalInterest">0</span></p>
                <p>роорпКродрпНрод роорпАродро┐ родрпКроХрпИ: тВ╣<span id="totalBalance">0</span></p>
            </div>
        </div>
        
        <div id="paymentHistoryModal" class="modal">
            <div class="modal-content">
                <h2 id="modalCustomerName">рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп ро╡ро┐ро╡ро░роорпН</h2>
                <div id="modalCustomerImageContainer" style="text-align: center; margin-bottom: 15px;"></div>
                <table id="paymentHistoryTable" style="width:100%;">
                    <thead>
                        <tr>
                            <th>родрпЗродро┐</th>
                            <th>ро╡роЯрпНроЯро┐ родрпКроХрпИ</th>
                            <th>рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ</th>
                            <th>роорпАродро┐</th>
                            <th>роХрпБро▒ро┐рокрпНрокрпБроХро│рпН</th>
                        </tr>
                    </thead>
                    <tbody id="paymentHistoryBody">
                    </tbody>
                </table>
                <button onclick="closeModal()" style="margin-top: 20px;">роорпВроЯрпБ</button>
            </div>
        </div>
        
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <h2>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роирпАроХрпНроХрпБроХро┐ро▒рпАро░рпНроХро│ро╛?</h2>
                <p id="deleteCustomerText">роЗроирпНрод ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роиро┐ро░роирпНродро░рооро╛роХ роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?</p>
                <div style="margin-top: 20px;">
                    <button onclick="confirmDelete()" class="delete-btn">роЖроорпН, роирпАроХрпНроХрпБ</button>
                    <button onclick="cancelDelete()">роЗро▓рпНро▓рпИ, ро░родрпНродрпБроЪрпЖропрпН</button>
                </div>
            </div>
        </div>
        
        <!-- Hidden print section -->
        <div id="printSection" style="display: none;"></div>
    </div>

    <script>
        let customers = JSON.parse(localStorage.getItem('interestBusinessCustomers')) || [];
        let payments = JSON.parse(localStorage.getItem('interestBusinessPayments')) || [];
        let customerToDelete = null;
        
        const customerForm = document.getElementById('customerForm');
        const paymentForm = document.getElementById('paymentForm');
        const customerSelect = document.getElementById('customerSelect');
        const customerTableBody = document.getElementById('customerTableBody');
        const dueAmountInput = document.getElementById('dueAmount');
        const paidAmountInput = document.getElementById('paidAmount');
        const balanceAmountInput = document.getElementById('balanceAmount');
        const printSection = document.getElementById('printSection');
        const customerImageInput = document.getElementById('customerImage');
        const customerImagePreview = document.getElementById('customerImagePreview');
        const customerSignatureInput = document.getElementById('customerSignature');
        const customerSignaturePreview = document.getElementById('customerSignaturePreview');
        const ownerSignatureInput = document.getElementById('ownerSignature');
        const ownerSignaturePreview = document.getElementById('ownerSignaturePreview');
        const addCustomerBtn = document.getElementById('addCustomerBtn');
        
        // Image preview functionality
        customerImageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customerImagePreview.src = e.target.result;
                    customerImagePreview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });
        
        // Customer signature preview functionality
        customerSignatureInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customerSignaturePreview.src = e.target.result;
                    customerSignaturePreview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });
        
        // Owner signature preview and permanent storage
        ownerSignatureInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    ownerSignaturePreview.src = e.target.result;
                    ownerSignaturePreview.style.display = 'block';
                    localStorage.setItem('ownerSignaturePermanent', e.target.result);
                }
                reader.readAsDataURL(file);
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load permanent owner signature if exists
            const permanentOwnerSignature = localStorage.getItem('ownerSignaturePermanent');
            if (permanentOwnerSignature) {
                ownerSignaturePreview.src = permanentOwnerSignature;
                ownerSignaturePreview.style.display = 'block';
            }
            
            renderCustomerSelect();
            renderCustomerTable();
            updateSummary();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('paymentDate').value = today;
            
            customerSelect.addEventListener('change', function() {
                const customerId = this.value;
                if (customerId) {
                    const customer = customers.find(c => c.id === customerId);
                    if (customer) {
                        const interestAmount = calculateMonthlyInterest(customer);
                        dueAmountInput.value = interestAmount.toFixed(2);
                        paidAmountInput.value = '';
                        balanceAmountInput.value = interestAmount.toFixed(2);
                    }
                }
            });
            
            paidAmountInput.addEventListener('input', function() {
                const dueAmount = parseFloat(dueAmountInput.value) || 0;
                const paidAmount = parseFloat(this.value) || 0;
                const balance = dueAmount - paidAmount;
                balanceAmountInput.value = balance.toFixed(2);
            });
        });
        
        // Improved form submission handling for mobile
        addCustomerBtn.addEventListener('click', function(e) {
            e.preventDefault();
            handleCustomerFormSubmit();
        });
        
        function handleCustomerFormSubmit() {
            const permanentOwnerSignature = localStorage.getItem('ownerSignaturePermanent');
            
            const customerName = document.getElementById('customerName').value;
            if (!customerName) {
                showMessage('formMessage', 'ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН родрпЗро╡рпИ!', 'error');
                return;
            }
            
            const principalAmount = parseFloat(document.getElementById('principalAmount').value);
            if (!principalAmount || principalAmount <= 0) {
                showMessage('formMessage', 'роЪро░ро┐ропро╛рой роЕроЪро▓рпН родрпКроХрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН!', 'error');
                return;
            }
            
            const customer = {
                id: Date.now().toString(),
                name: customerName,
                phone: document.getElementById('phoneNumber').value,
                aadhar: document.getElementById('aadharNumber').value,
                principal: principalAmount,
                rate: parseFloat(document.getElementById('interestRate').value),
                startDate: document.getElementById('startDate').value,
                image: customerImagePreview.src || '',
                signature_customer: customerSignaturePreview.src || '',
                signature: permanentOwnerSignature || ownerSignaturePreview.src || ''
            };
            
            customers.push(customer);
            saveData();
            
            customerForm.reset();
            customerImagePreview.src = '';
            customerImagePreview.style.display = 'none';
            customerSignaturePreview.src = '';
            customerSignaturePreview.style.display = 'none';
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('interestRate').value = '3';
            
            showMessage('formMessage', 'ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯро╛ро░рпН!', 'success');
            
            renderCustomerSelect();
            renderCustomerTable();
            updateSummary();
        }
        
        function calculateMonthlyInterest(customer) {
            return customer.principal * (customer.rate / 100);
        }
        
        paymentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerId = customerSelect.value;
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const payment = {
                id: Date.now().toString(),
                customerId: customerId,
                date: document.getElementById('paymentDate').value,
                dueAmount: parseFloat(dueAmountInput.value),
                paidAmount: parseFloat(paidAmountInput.value),
                balance: parseFloat(balanceAmountInput.value),
                notes: document.getElementById('paymentNotes').value
            };
            
            payments.push(payment);
            saveData();
            
            // Send SMS to customer if phone exists
            if (customer.phone && customer.phone.length === 10) {
                sendSMSNotification(customer.phone, customer.name, payment.paidAmount, payment.balance);
            }
            
            paymentForm.reset();
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            dueAmountInput.value = '';
            paidAmountInput.value = '';
            balanceAmountInput.value = '';
            
            showMessage('paymentMessage', 'ро╡роЯрпНроЯро┐ рокрогроорпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ!', 'success');
            
            renderCustomerTable();
            updateSummary();
        });
        
        function sendSMSNotification(phoneNumber, customerName, paidAmount, balance) {
            const message = `ANNAMALAIYAR FINANCE: ро╡рогроХрпНроХроорпН ${customerName}, роЙроЩрпНроХро│рпН тВ╣${paidAmount.toFixed(2)} ро╡роЯрпНроЯро┐родрпН родрпКроХрпИ рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ. роорпАродро┐: тВ╣${balance.toFixed(2)}. роиройрпНро▒ро┐!`;
            console.log(`SMS sent to customer ${phoneNumber}: ${message}`);
            // In a real implementation, you would call an SMS API here
        }
        
        function preparePrintContent(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const customerPayments = payments.filter(p => p.customerId === customerId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const totalPaid = customerPayments.reduce((sum, p) => sum + p.paidAmount, 0);
            const totalBalance = customerPayments.reduce((sum, p) => sum + p.balance, 0);
            const monthlyInterest = calculateMonthlyInterest(customer);
            
            const formattedAadhar = customer.aadhar 
                ? `${customer.aadhar.substring(0, 4)}-${customer.aadhar.substring(4, 8)}-${customer.aadhar.substring(8, 12)}` 
                : '-';
            
            let printHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1 style="margin-bottom: 5px;">ANNAMALAIYAR FINANCE</h1>
                    <p style="font-size: 12px; margin-top: 5px;">роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ родрпЗродро┐: ${formatDate(new Date())}</p>
                </div>
                
                <div style="text-align: center; margin-bottom: 20px;">
                    ${customer.image ? `<img src="${customer.image}" class="print-image" alt="Customer Image">` : ''}
                </div>
                
                <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 5px;">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпН</h2>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd; width: 30%;">рокрпЖропро░рпН</td>
                        <td style="padding: 5px; border: 1px solid #ddd; width: 70%;">${customer.name}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">родрпКро▓рпИрокрпЗроЪро┐</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">${customer.phone || '-'}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">роЖродро╛ро░рпН</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">${formattedAadhar}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">роЕроЪро▓рпН родрпКроХрпИ</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">тВ╣${customer.principal.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">${customer.rate}%</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">рооро╛родро╛роирпНродро┐ро░ ро╡роЯрпНроЯро┐ родрпКроХрпИ</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">тВ╣${monthlyInterest.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">родрпКроЯроХрпНроХ родрпЗродро┐</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">${formatDate(new Date(customer.startDate))}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">роорпКродрпНродроорпН роЪрпЖро▓рпБродрпНродро┐ропродрпБ</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">тВ╣${totalPaid.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">роорпКродрпНродроорпН роорпАродро┐</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">тВ╣${totalBalance.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold; padding: 5px; border: 1px solid #ddd;">роХроЯрпИроЪро┐ рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп родрпЗродро┐</td>
                        <td style="padding: 5px; border: 1px solid #ddd;">${customerPayments.length > 0 ? formatDate(new Date(customerPayments[customerPayments.length - 1].date)) : 'роЗро▓рпНро▓рпИ'}</td>
                    </tr>
                </table>
            `;
            
            if (customerPayments.length > 0) {
                printHTML += `
                    <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-top: 20px;">рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп ро╡ро░ро▓ро╛ро▒рпБ</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr>
                                <th style="background-color: #3498db; color: white; padding: 8px; border: 1px solid #ddd;">родрпЗродро┐</th>
                                <th style="background-color: #3498db; color: white; padding: 8px; border: 1px solid #ddd;">ро╡роЯрпНроЯро┐ родрпКроХрпИ</th>
                                <th style="background-color: #3498db; color: white; padding: 8px; border: 1px solid #ddd;">рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ</th>
                                <th style="background-color: #3498db; color: white; padding: 8px; border: 1px solid #ddd;">роорпАродро┐</th>
                                <th style="background-color: #3498db; color: white; padding: 8px; border: 1px solid #ddd;">роХрпБро▒ро┐рокрпНрокрпБроХро│рпН</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                customerPayments.forEach(payment => {
                    printHTML += `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(new Date(payment.date))}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">тВ╣${payment.dueAmount.toFixed(2)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">тВ╣${payment.paidAmount.toFixed(2)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">тВ╣${payment.balance.toFixed(2)}</td>
                            <td style="padding: 8px; border: 1px solid #ddd;">${payment.notes || '-'}</td>
                        </tr>
                    `;
                });
                
                printHTML += `
                        </tbody>
                    </table>
                `;
            }
            
            // Add signature section with both customer and owner signatures
            printHTML += `
                <div class="signature-container">
                    <div class="signature-box">
                        ${customer.signature_customer ? `<img src="${customer.signature_customer}" class="print-signature" alt="Customer Signature">` : '<div class="signature-line"></div>'}
                        <p class="signature-title">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роХрпИропрпКрокрпНрокроорпН</p>
                    </div>
                    <div class="signature-box">
                        ${customer.signature ? `<img src="${customer.signature}" class="print-signature" alt="Owner Signature">` : '<div class="signature-line"></div>'}
                        <p class="signature-title">роЙро░ро┐роорпИропро╛ро│ро░рпН роХрпИропрпКрокрпНрокроорпН</p>
                    </div>
                </div>
                
                <div class="print-footer">
                    <p>ANNAMALAIYAR FINANCE</p>
                    <p>рокроХрпНроХроорпН: <span class="page-number"></span></p>
                </div>
            `;
            
            return printHTML;
        }
        
        function formatDate(date) {
            if (!date || isNaN(new Date(date).getTime())) return '';
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit'
            };
            return new Date(date).toLocaleDateString('en-IN', options);
        }
        
        function printCustomerDetails(customerId) {
            const printContent = preparePrintContent(customerId);
            if (!printContent) return;
            
            printSection.innerHTML = printContent;
            printSection.style.display = 'block';
            
            window.print();
            
            setTimeout(() => {
                printSection.style.display = 'none';
                printSection.innerHTML = '';
            }, 500);
        }
        
        function renderCustomerSelect() {
            customerSelect.innerHTML = '<option value="">-- ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (тВ╣${customer.principal.toFixed(2)})`;
                customerSelect.appendChild(option);
            });
        }
        
        function renderCustomerTable(filteredCustomers = null) {
            const displayCustomers = filteredCustomers || customers;
            customerTableBody.innerHTML = '';
            
            displayCustomers.forEach(customer => {
                const customerPayments = payments.filter(p => p.customerId === customer.id);
                const totalPaid = customerPayments.reduce((sum, p) => sum + p.paidAmount, 0);
                const totalBalance = customerPayments.reduce((sum, p) => sum + p.balance, 0);
                const lastPayment = customerPayments.length > 0 
                    ? formatDate(new Date(customerPayments[customerPayments.length - 1].date))
                    : 'роЗро▓рпНро▓рпИ';
                const monthlyInterest = calculateMonthlyInterest(customer);
                
                const formattedAadhar = customer.aadhar 
                    ? `${customer.aadhar.substring(0, 4)}-${customer.aadhar.substring(4, 8)}-${customer.aadhar.substring(8, 12)}` 
                    : '-';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.image ? `<img src="${customer.image}" class="customer-image" alt="${customer.name}">` : '-'}</td>
                    <td class="nowrap">${customer.name}</td>
                    <td class="nowrap">${customer.phone || '-'}</td>
                    <td class="nowrap">${formattedAadhar}</td>
                    <td class="nowrap">тВ╣${customer.principal.toFixed(2)}</td>
                    <td>${customer.rate}%</td>
                    <td class="nowrap">тВ╣${monthlyInterest.toFixed(2)}</td>
                    <td class="nowrap">${formatDate(new Date(customer.startDate))}</td>
                    <td class="nowrap">тВ╣${totalPaid.toFixed(2)}</td>
                    <td class="nowrap balance">тВ╣${totalBalance.toFixed(2)}</td>
                    <td class="nowrap">${lastPayment}</td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="viewPaymentHistory('${customer.id}', '${customer.name}', '${customer.image || ''}')">рокрогроорпН рокро╛ро░рпНроХрпНроХ</button>
                            <button onclick="printCustomerDetails('${customer.id}')" class="print-btn">роЕроЪрпНроЪро┐роЯрпБ</button>
                            <button onclick="showDeleteModal('${customer.id}', '${customer.name}')" class="delete-btn">роирпАроХрпНроХрпБ</button>
                        </div>
                    </td>
                `;
                customerTableBody.appendChild(row);
            });
        }
        
        function updateSummary() {
            document.getElementById('totalCustomers').textContent = customers.length;
            
            const totalPrincipal = customers.reduce((sum, c) => sum + c.principal, 0);
            document.getElementById('totalPrincipal').textContent = totalPrincipal.toFixed(2);
            
            const totalInterest = payments.reduce((sum, p) => sum + p.paidAmount, 0);
            document.getElementById('totalInterest').textContent = totalInterest.toFixed(2);
            
            const totalBalance = payments.reduce((sum, p) => sum + p.balance, 0);
            document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);
        }
        
        function viewPaymentHistory(customerId, customerName, customerImage) {
            const modal = document.getElementById('paymentHistoryModal');
            const customerPayments = payments.filter(p => p.customerId === customerId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('modalCustomerName').textContent = `${customerName} - рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп ро╡ро┐ро╡ро░роорпН`;
            
            const imageContainer = document.getElementById('modalCustomerImageContainer');
            imageContainer.innerHTML = customerImage 
                ? `<img src="${customerImage}" class="customer-image" alt="${customerName}">`
                : '';
            
            const paymentHistoryBody = document.getElementById('paymentHistoryBody');
            paymentHistoryBody.innerHTML = '';
            
            if (customerPayments.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align:center;">рокрогроорпН роЪрпЖро▓рпБродрпНродро┐ропродрпБ роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ</td>';
                paymentHistoryBody.appendChild(row);
            } else {
                customerPayments.forEach(payment => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="nowrap">${formatDate(new Date(payment.date))}</td>
                        <td class="nowrap">тВ╣${payment.dueAmount.toFixed(2)}</td>
                        <td class="nowrap">тВ╣${payment.paidAmount.toFixed(2)}</td>
                        <td class="nowrap balance">тВ╣${payment.balance.toFixed(2)}</td>
                        <td>${payment.notes || '-'}</td>
                    `;
                    paymentHistoryBody.appendChild(row);
                });
            }
            
            modal.style.display = 'flex';
        }
        
        function showDeleteModal(customerId, customerName) {
            customerToDelete = customerId;
            document.getElementById('deleteCustomerText').textContent = 
                `роирпАроЩрпНроХро│рпН "${customerName}" ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роиро┐ро░роирпНродро░рооро╛роХ роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?`;
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function confirmDelete() {
            if (customerToDelete) {
                customers = customers.filter(c => c.id !== customerToDelete);
                payments = payments.filter(p => p.customerId !== customerToDelete);
                saveData();
                
                renderCustomerSelect();
                renderCustomerTable();
                updateSummary();
                
                showMessage('formMessage', 'ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роирпАроХрпНроХрокрпНрокроЯрпНроЯро╛ро░рпН!', 'success');
            }
            closeModal();
            customerToDelete = null;
        }
        
        function cancelDelete() {
            closeModal();
            customerToDelete = null;
        }
        
        function closeModal() {
            document.getElementById('paymentHistoryModal').style.display = 'none';
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        function searchCustomers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) return;
            
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) || 
                (c.phone && c.phone.includes(searchTerm)) ||
                (c.aadhar && c.aadhar.includes(searchTerm)));
            
            renderCustomerTable(filtered);
        }
        
        function resetSearch() {
            document.getElementById('searchInput').value = '';
            renderCustomerTable();
        }
        
        function showMessage(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = 'message ' + type;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 3000);
        }
        
        function saveData() {
            localStorage.setItem('interestBusinessCustomers', JSON.stringify(customers));
            localStorage.setItem('interestBusinessPayments', JSON.stringify(payments));
        }
        
    </script>
</body>
</html>